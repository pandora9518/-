import{I as k,d as le,k as d,A as ae,r as u,o as te,c as oe,h as e,w as a,u as r,x,y as m,a as I,F as ne,n as E,L as b}from"./index-511768d2.js";import{u as re}from"./setting-671950c7.js";const se=(s,v,p)=>k.get(`/admin/acl/role/${s}/${v}/?roleName=${p}`),ie=s=>s.id?k.put("/admin/acl/role/update",s):k.post("/admin/acl/role/save",s),de=s=>k.get("/admin/acl/permission/toAssign/"+s),ue=(s,v)=>k.post(`/admin/acl/permission/doAssign/?roleId=${s} & permissionId=${v}`),ce=s=>k.delete("/admin/acl/permission/remove/"+s),pe=I("h4",null,"分配菜单和按钮的权限",-1),me={style:{flex:"auto"}},ye=le({__name:"index",setup(s){let v=re(),p=d(1),h=d(10),_=d(""),N=d([]),S=d(0),f=d(!1),i=d({roleName:""}),V=d(),z=d(),w=d(!1),R=d([]),U=d([]);ae(()=>{g()});const g=async(o=1)=>{p.value=o;let l=await se(p.value,h.value,_.value);l.code==200&&(N.value=l.data.records,S.value=l.data.total)},$=()=>{g()},j=()=>{v.refresh=!v.refresh,_.value=""},M=()=>{g()},O=()=>{f.value=!0,E(()=>{V.value.clearValidate("roleName")}),Object.assign(i.value,{roleName:"",id:0})},T=o=>{f.value=!0,E(()=>{V.value.clearValidate("roleName")}),Object.assign(i.value,o)},B=()=>{f.value=!1},D=async()=>{await V.value.validate(),(await ie(i.value)).code==200?(b({type:"success",message:i.value.id?"修改用户成功":"添加用户成功"}),f.value=!1,g()):b({type:"success",message:i.value.id?"修改用户失败":"添加用户失败"})},F={roleName:[{required:!0,trigger:"blur",validator:(o,l,n)=>{l.trim().length>2?n():n(new Error("职位名称应该大于2位"))}}]},H={children:"children",label:"name"},K=async o=>{w.value=!0,Object.assign(i.value,o);let l=await de(i.value.id);l.code==200&&(R.value=l.data,q(R.value,U.value))},q=(o,l)=>{o.forEach(n=>{n.select&&n.level==4&&l.push(n.id),n.children&&n.children.length>0&&q(n.children,l)})},G=async()=>{let o=i.value.id,l=z.value.getCheckedKeys(),n=z.value.getHalfCheckedKeys(),C=l.concat(n);(await ue(o,C)).code==200?(b({type:"success",message:"分配权限成功"}),g(),window.location.reload()):b({type:"error",message:"分配权限失败"})},J=async o=>{(await ce(o.id)).code==200?(b({type:"success",message:"删除职位成功"}),g(N.value.length>1?p.value:p.value-1)):b({type:"error",message:"删除职位失败"})};return(o,l)=>{const n=u("el-input"),C=u("el-form-item"),c=u("el-button"),A=u("el-form"),L=u("el-card"),y=u("el-table-column"),Q=u("el-popconfirm"),W=u("el-table"),X=u("el-pagination"),Y=u("el-dialog"),Z=u("el-tree"),ee=u("el-drawer");return te(),oe(ne,null,[e(L,{class:"box-card"},{default:a(()=>[e(A,{inline:!0,class:"user"},{default:a(()=>[e(C,{label:"职位搜索:"},{default:a(()=>[e(n,{placeholder:"请你输入搜索职位关键字",modelValue:r(_),"onUpdate:modelValue":l[0]||(l[0]=t=>x(_)?_.value=t:_=t)},null,8,["modelValue"])]),_:1}),e(C,null,{default:a(()=>[e(c,{type:"primary",size:"default",disabled:!r(_),onClick:M},{default:a(()=>[m("搜索")]),_:1},8,["disabled"]),e(c,{size:"default",onClick:j},{default:a(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(L,null,{default:a(()=>[e(c,{type:"primary",size:"default",onClick:O},{default:a(()=>[m("添加职位")]),_:1}),e(W,{border:"",style:{margin:"10px 0"},data:r(N)},{default:a(()=>[e(y,{label:"#",align:"center",type:"index"}),e(y,{label:"ID",align:"center",prop:"id"}),e(y,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(y,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(y,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(y,{label:"操作",width:"280px",align:"center"},{default:a(({row:t,$index:_e})=>[e(c,{type:"primary",size:"small",icon:"User",onClick:P=>K(t)},{default:a(()=>[m("分配角色")]),_:2},1032,["onClick"]),e(c,{type:"info",size:"small",icon:"Edit",onClick:P=>T(t)},{default:a(()=>[m("编辑")]),_:2},1032,["onClick"]),e(Q,{title:`你确定要删除${t.roleName}吗?`,onConfirm:P=>J(t),width:"250"},{reference:a(()=>[e(c,{type:"danger",size:"small",icon:"Delete"},{default:a(()=>[m("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(X,{"current-page":r(p),"onUpdate:currentPage":l[1]||(l[1]=t=>x(p)?p.value=t:p=t),"page-size":r(h),"onUpdate:pageSize":l[2]||(l[2]=t=>x(h)?h.value=t:h=t),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(S),onSizeChange:$,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),e(Y,{modelValue:r(f),"onUpdate:modelValue":l[4]||(l[4]=t=>x(f)?f.value=t:f=t),title:r(i).id?"更新用户":"添加用户"},{footer:a(()=>[e(c,{type:"primary",size:"default",onClick:B},{default:a(()=>[m("取消")]),_:1}),e(c,{type:"primary",size:"default",onClick:D},{default:a(()=>[m("确定")]),_:1})]),default:a(()=>[e(A,{rules:F,model:r(i),ref_key:"form",ref:V},{default:a(()=>[e(C,{label:"职位名称",prop:"roleName"},{default:a(()=>[e(n,{placeholder:"请输入职位名称",modelValue:r(i).roleName,"onUpdate:modelValue":l[3]||(l[3]=t=>r(i).roleName=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(ee,{modelValue:r(w),"onUpdate:modelValue":l[5]||(l[5]=t=>x(w)?w.value=t:w=t)},{header:a(()=>[pe]),default:a(()=>[e(Z,{data:r(R),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(U),props:H,ref_key:"tree",ref:z},null,8,["data","default-checked-keys"])]),footer:a(()=>[I("div",me,[e(c,null,{default:a(()=>[m("取消")]),_:1}),e(c,{type:"primary",onClick:G},{default:a(()=>[m("确认")]),_:1})])]),_:1},8,["modelValue"])],64)}}});export{ye as default};
