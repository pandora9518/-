import{d as M,N as Q,k as C,D as G,l as H,O as K,B as R,r as u,o as v,c as N,h as e,u as r,w as t,q as L,a as A,y as _,F as W,f as X,g as I,t as z,v as B,n as T,P as Y,L as f,Q as Z}from"./index-511768d2.js";const ee=["onClick"],le=M({__name:"index",setup(te){let p=Q(),b=C([]),c=C(0),y=C([]),s=G({createTime:null,updateTime:null,attrName:"",categoryId:0,categoryLevel:3,attrValueList:[]});H(()=>p.c3Id,()=>{b.value=[],p.c3Id&&k()});let k=async()=>{let{c1Id:l,c2Id:i,c3Id:g}=p,n=await K(l,i,g);n.code==200&&(b.value=n.data)},$=()=>{Object.assign(s,{createTime:null,updateTime:null,attrName:"",categoryId:p.c3Id,categoryLevel:3,attrValueList:[]}),c.value=1},D=l=>{Object.assign(s,JSON.parse(JSON.stringify(l))),c.value=1};const O=()=>{s.attrValueList.push({valueName:"",createTime:null,updateTime:null,flag:!0}),T(()=>{console.log(y.value.length-1),y.value[y.value.length-1].focus()})},S=async()=>{(await Y(s)).code==200?(f({type:"success",message:s.id?"修改成功":"添加成功"}),k()):f({type:"error",message:s.id?"修改失败":"添加失败"}),c.value=0},V=()=>{c.value=0},w=(l,i)=>{if(l.valueName==""){f({type:"error",message:"属性值不能为空,请重新输入"});return}if(s.attrValueList.find(n=>{if(n!=l)return n.valueName==l.valueName})){f({type:"error",message:"属性值不能重复"}),s.attrValueList.splice(i,1);return}l.flag=!1},U=(l,i)=>{l.flag=!0,T(()=>{y.value[i].focus()})},q=async l=>{(await Z(l)).code==200?(f({type:"success",message:"删除成功"}),k()):f({type:"error",message:"删除失败"})};return R(()=>{p.$reset()}),(l,i)=>{const g=u("Category"),n=u("el-button"),d=u("el-table-column"),E=u("el-tag"),P=u("el-popconfirm"),x=u("el-table"),h=u("el-input"),j=u("el-form-item"),F=u("el-from"),J=u("el-card");return v(),N("div",null,[e(g,{scene:r(c)},null,8,["scene"]),e(J,{class:"box-card"},{default:t(()=>[L(A("div",null,[e(n,{type:"primary",size:"default",icon:"Plus",onClick:r($),disabled:!r(p).c3Id},{default:t(()=>[_("添加平台属性")]),_:1},8,["onClick","disabled"]),e(x,{border:"",data:r(b)},{default:t(()=>[e(d,{label:"序列",type:"index",width:"80px"}),e(d,{label:"属性名称",width:"120px",prop:"attrName"}),e(d,{label:"属性值名称"},{default:t(({row:a,$index:m})=>[(v(!0),N(W,null,X(a.attrValueList,o=>(v(),I(E,{key:o.attrId,type:"primary"},{default:t(()=>[_(z(o.valueName),1)]),_:2},1024))),128))]),_:1}),e(d,{label:"操作",width:"120px"},{default:t(({row:a,$index:m})=>[e(n,{type:"primary",size:"small",icon:"Edit",onClick:o=>r(D)(a)},null,8,["onClick"]),e(P,{title:`是否确认删除${a.attrName}`,onConfirm:o=>q(a.id)},{reference:t(()=>[e(n,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[B,r(c)==0]]),L(A("div",null,[e(F,{"label-width":"auto"},{default:t(()=>[e(j,{label:"属性名称",inline:!0},{default:t(()=>[e(h,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:r(s).attrName,"onUpdate:modelValue":i[0]||(i[0]=a=>r(s).attrName=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{disabled:!r(s).attrName,type:"primary",icon:"Plus",size:"default",onClick:O},{default:t(()=>[_("添加属性值")]),_:1},8,["disabled"]),e(n,{size:"default",onClick:V},{default:t(()=>[_("取消")]),_:1}),e(x,{border:"",style:{margin:"10px 0px"},data:r(s).attrValueList},{default:t(()=>[e(d,{label:"序号",type:"index",width:"80px",align:"center"}),e(d,{label:"属性值"},{default:t(({row:a,$index:m})=>[a.flag?(v(),I(h,{key:0,ref:o=>r(y)[m]=o,modelValue:a.valueName,"onUpdate:modelValue":o=>a.valueName=o,onBlur:o=>w(a,m)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(v(),N("div",{key:1,onClick:o=>U(a,m)},z(a.valueName),9,ee))]),_:1}),e(d,{label:"操作"},{default:t(({row:a,$index:m})=>[e(n,{type:"danger",size:"small",icon:"Delete",onClick:o=>r(s).attrValueList.splice(m,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(n,{type:"primary",size:"default",onClick:S},{default:t(()=>[_("保存")]),_:1}),e(n,{size:"default",onClick:V},{default:t(()=>[_("取消")]),_:1})],512),[[B,r(c)!=0]])]),_:1})])}}});export{le as default};
