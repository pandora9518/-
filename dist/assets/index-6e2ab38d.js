import{I as w,d as Y,k as c,J as re,r as o,o as S,g as L,w as a,h as e,u as t,c as q,F as B,f as R,x as j,a as G,y as F,t as de,L as h,D as ie,O as pe,N as me,l as ce,B as ge,q as W,v as X}from"./index-511768d2.js";const _e=(_,P,N)=>w.get(`/admin/product/${_}/${P}?category3Id=${N}`),Z=()=>w.get("/admin/product/baseTrademark/getTrademarkList"),le=_=>w.get(`/admin/product/spuImageList/${_}`),te=_=>w.get(`/admin/product/spuSaleAttrList/${_}`),ee=()=>w.get("/admin/product/baseSaleAttrList"),fe=_=>(console.log(_),_.id?w.post("/admin/product/updateSpuInfo",_):w.post("/admin/product/saveSpuInfo",_)),Se=_=>w.post("/admin/product/saveSkuInfo",_),ve=_=>w.get("/admin/product/findBySpuId/"+_),ke=_=>w.delete("/admin/product/deleteSpu/"+_),ye=["src"],be=Y({__name:"spuForm",emits:["changeScene"],setup(_,{expose:P,emit:N}){let k=c([]),y=c([]),b=c([]),d=c([]),V=c(!1),z=c(""),g=c({category3Id:"",description:"",spuName:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),f=c(""),D=()=>{N("changeScene",{flag:0,params:"update"})},x=async l=>{g.value=l;let n=await Z();k.value=n.data;let u=await le(l.id);y.value=u.data.map(r=>({name:r.imgName,url:r.imgUrl}));let C=await te(l.id);b.value=C.data;let K=await ee();d.value=K.data},v=async l=>{Object.assign(g.value,{category3Id:"",description:"",spuName:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),y.value=[],b.value=[],g.value.category3Id=l,f.value="";let n=await Z();k.value=n.data;let u=await ee();d.value=u.data},A=l=>{if(l.type=="image/jpg",l.size/1024/1024>4)return h({type:"error",message:"上传文件大小必须小于4M"}),!1;h({type:"success",message:"上传成功"})},m=l=>{z.value=l.url,V.value=!0},I=()=>{console.log(123)},U=re(()=>d.value.filter(n=>b.value.every(u=>n.name!=u.saleAttrName))),i=()=>{let[l,n]=f.value.split(":"),u={saleAttrName:n,baseSaleAttrId:l,spuSaleAttrValueList:[]};b.value.push(u),f.value=""},p=l=>{l.flag=!0},E=l=>{let{baseSaleAttrId:n,spuSaleAttrValue:u}=l,C={baseSaleAttrId:n,saleAttrValueName:u};if(!u.trim()){h({type:"error",message:"属性值不能为空"});return}if(l.spuSaleAttrValueList.find(r=>r.saleAttrValueName==u)){h({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(C),l.flag=!1},$=async()=>{let l=y.value.map(u=>({imgName:u.name,imgUrl:u.response?u.response.data:u.url}));g.value.spuImageList=l,g.value.spuSaleAttrList=b.value;let n=await fe(g.value);console.log(n),n.code==200?(h({type:"success",message:g.value.id?"修改Spu成功":"添加Spu成功"}),N("changeScene",{flag:0,params:g.value.id?"update":"add"})):h({type:"error",message:g.value.id?"修改Spu成功":"添加Spu成功"})};return P({initEditSpuData:x,initAddSpuDate:v}),(l,n)=>{const u=o("el-input"),C=o("el-form-item"),K=o("el-option"),r=o("el-select"),H=o("Plus"),M=o("el-icon"),ae=o("el-upload"),ue=o("el-dialog"),O=o("el-button"),J=o("el-table-column"),ne=o("el-tag"),se=o("el-table"),oe=o("el-form");return S(),L(oe,{"label-width":"100px"},{default:a(()=>[e(C,{label:"SPU名称"},{default:a(()=>[e(u,{placeholder:"请你输入SPU名称",modelValue:t(g).spuName,"onUpdate:modelValue":n[0]||(n[0]=s=>t(g).spuName=s)},null,8,["modelValue"])]),_:1}),e(C,{label:"SPU品牌"},{default:a(()=>[e(r,{placeholder:"请你选择品牌",modelValue:t(g).tmId,"onUpdate:modelValue":n[1]||(n[1]=s=>t(g).tmId=s)},{default:a(()=>[(S(!0),q(B,null,R(t(k),s=>(S(),L(K,{key:s.id,label:s.tmName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"SPU描述"},{default:a(()=>[e(u,{type:"textarea",modelValue:t(g).description,"onUpdate:modelValue":n[2]||(n[2]=s=>t(g).description=s)},null,8,["modelValue"])]),_:1}),e(C,{label:"SPU照片"},{default:a(()=>[e(ae,{"file-list":t(y),"onUpdate:fileList":n[3]||(n[3]=s=>j(y)?y.value=s:y=s),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":t(m),"on-remove":t(I),"before-upload":t(A)},{default:a(()=>[e(M,null,{default:a(()=>[e(H)]),_:1})]),_:1},8,["file-list","on-preview","on-remove","before-upload"]),e(ue,{modelValue:t(V),"onUpdate:modelValue":n[4]||(n[4]=s=>j(V)?V.value=s:V=s)},{default:a(()=>[G("img",{"w-full":"",src:t(z),style:{width:"100%",height:"100%"},alt:"Preview Image"},null,8,ye)]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"SPU销售属性"},{default:a(()=>[e(r,{placeholder:t(U).length?`还有${t(U).length}个属性未选择`:"未选择的属性为空",modelValue:t(f),"onUpdate:modelValue":n[5]||(n[5]=s=>j(f)?f.value=s:f=s)},{default:a(()=>[(S(!0),q(B,null,R(t(U),s=>(S(),L(K,{value:`${s.id}:${s.name}`,key:s.id,label:s.name},null,8,["value","label"]))),128))]),_:1},8,["placeholder","modelValue"]),e(O,{disabled:!t(f),type:"primary",size:"default",icon:"Plus",style:{"margin-left":"10px"},onClick:t(i)},{default:a(()=>[F("添加销售属性")]),_:1},8,["disabled","onClick"]),e(se,{border:"",style:{margin:"10px 0"},data:t(b)},{default:a(()=>[e(J,{label:"序号",type:"index",align:"center",width:"100px"}),e(J,{label:"属性名",width:"100px",prop:"saleAttrName"}),e(J,{label:"属性值"},{default:a(({row:s,$index:Q})=>[(S(!0),q(B,null,R(s.spuSaleAttrValueList,T=>(S(),L(ne,{onClose:Ue=>s.spuSaleAttrValueList.splice(Q,1),key:T.id,class:"mx-1",closable:"",style:{margin:"0 5px"},type:"success"},{default:a(()=>[F(de(T.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),s.flag?(S(),L(u,{key:0,onBlur:T=>t(E)(s),modelValue:s.spuSaleAttrValue,"onUpdate:modelValue":T=>s.spuSaleAttrValue=T,placeholder:"请输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(S(),L(O,{key:1,type:"primary",size:"small",icon:"Plus",onClick:T=>t(p)(s)},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"100px"},{default:a(({row:s,$index:Q})=>[e(O,{type:"danger",size:"small",icon:"Delete",onClick:T=>t(b).splice(Q,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(C,null,{default:a(()=>[e(O,{type:"primary",size:"default",onClick:t($)},{default:a(()=>[F("保存")]),_:1},8,["onClick"]),e(O,{size:"default",onClick:t(D)},{default:a(()=>[F("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})}}}),Ve=["src","title"],Ae=Y({__name:"skuForm",emits:["changeScene"],setup(_,{expose:P,emit:N}){let k=c([]),y=c([]),b=c([]),d=ie({category3Id:"",tmId:"",spuId:0,skuName:"",price:"",weight:"",skuDesc:"",skuDefaultImg:"",skuAttrValueList:[],skuSaleAttrValueList:[]}),V=c(),z=async()=>{let x=k.value.reduce((m,I)=>{if(I.skuAttrAndValueId){let[U,i]=I.skuAttrAndValueId.split(":");m.push({attrId:U,valueId:i})}return m},[]);d.skuAttrValueList=x;let v=b.value.reduce((m,I)=>{if(I.saleAttrAndValueId){let[U,i]=I.saleAttrAndValueId.split(":");m.push({saleAttrId:U,saleAttrValueId:i})}return m},[]);d.skuSaleAttrValueList=v,(await Se(d)).code==200?(h({type:"success",message:"SKU添加成功"}),N("changeScene",{flag:0,params:""})):h({type:"error",message:"SKU添加失败"})},g=()=>{N("changeScene",{flag:0,params:""})},f=x=>{d.skuDefaultImg=x.imgUrl,y.value.forEach(v=>{V.value.toggleRowSelection(v,!1)}),V.value.toggleRowSelection(x,!0)};return P({initAddSkuDate:async(x,v,A)=>{d={category3Id:"",tmId:"",spuId:0,skuName:"",price:"",weight:"",skuDesc:"",skuDefaultImg:"",skuAttrValueList:[],skuSaleAttrValueList:[]},d.category3Id=A.category3Id,d.spuId=A.id,d.tmId=A.tmId;let m=await pe(x,v,A.category3Id),I=await le(A.id),U=await te(A.id);k.value=m.data,y.value=I.data,b.value=U.data}}),(x,v)=>{const A=o("el-input"),m=o("el-form-item"),I=o("el-option"),U=o("el-select"),i=o("el-form"),p=o("el-table-column"),E=o("el-button"),$=o("el-table");return S(),L(i,{"label-width":"100px"},{default:a(()=>[e(m,{label:"sku名称"},{default:a(()=>[e(A,{placeholder:"SKU名称",modelValue:t(d).skuName,"onUpdate:modelValue":v[0]||(v[0]=l=>t(d).skuName=l)},null,8,["modelValue"])]),_:1}),e(m,{label:"价格(元)"},{default:a(()=>[e(A,{placeholder:"价格(元)",type:"number",modelValue:t(d).price,"onUpdate:modelValue":v[1]||(v[1]=l=>t(d).price=l)},null,8,["modelValue"])]),_:1}),e(m,{label:"重量(g)"},{default:a(()=>[e(A,{placeholder:"重量(g)",type:"number",modelValue:t(d).weight,"onUpdate:modelValue":v[2]||(v[2]=l=>t(d).weight=l)},null,8,["modelValue"])]),_:1}),e(m,{label:"sku描述"},{default:a(()=>[e(A,{placeholder:"sku描述",type:"textarea",modelValue:t(d).skuDesc,"onUpdate:modelValue":v[3]||(v[3]=l=>t(d).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(m,{label:"平台属性"},{default:a(()=>[e(i,{inline:!0,"label-width":"80px"},{default:a(()=>[(S(!0),q(B,null,R(t(k),(l,n)=>(S(),L(m,{label:l.attrName,key:l.id},{default:a(()=>[e(U,{modelValue:l.skuAttrAndValueId,"onUpdate:modelValue":u=>l.skuAttrAndValueId=u},{default:a(()=>[(S(!0),q(B,null,R(l.attrValueList,(u,C)=>(S(),L(I,{value:`${l.id}:${u.id}`,label:u.valueName,key:u.id},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,{label:"销售属性"},{default:a(()=>[e(i,{inline:!0,"label-width":"80px"},{default:a(()=>[(S(!0),q(B,null,R(t(b),(l,n)=>(S(),L(m,{label:l.saleAttrName,key:l.id},{default:a(()=>[e(U,{modelValue:l.saleAttrAndValueId,"onUpdate:modelValue":u=>l.saleAttrAndValueId=u},{default:a(()=>[(S(!0),q(B,null,R(l.spuSaleAttrValueList,(u,C)=>(S(),L(I,{label:u.saleAttrValueName,value:`${l.id}:${u.id}`,key:u.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,null,{default:a(()=>[e($,{border:"",data:t(y),ref_key:"table",ref:V},{default:a(()=>[e(p,{type:"selection",align:"center"}),e(p,{label:"图片"},{default:a(({row:l,$index:n})=>[G("img",{src:l.imgUrl,title:l.imgName,style:{width:"80px",height:"80px"}},null,8,Ve)]),_:1}),e(p,{label:"名称",prop:"imgName"}),e(p,{label:"操作"},{default:a(({row:l,$index:n})=>[e(E,{type:"warning",size:"large",onClick:u=>t(f)(l)},{default:a(()=>[F("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(m,null,{default:a(()=>[e(E,{type:"primary",size:"default",onClick:t(z)},{default:a(()=>[F("确认")]),_:1},8,["onClick"]),e(E,{type:"info",size:"default",onClick:t(g)},{default:a(()=>[F("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})}}}),Ie=["src"],he=Y({__name:"index",setup(_){let P=c(),N=c(),k=c(1),y=c(3),b=c(!1),d=c(),V=me(),z=c([]),g=c(10),f=c(0);ce(()=>V.c3Id,()=>{D()});let D=async(i=1)=>{k.value=i;let p=await _e(k.value,y.value,V.c3Id);p.code==200?(z.value=p.data.records,g.value=p.data.total):h({type:"error",message:"获取Spu数据失败"})},x=()=>{f.value=1,P.value.initAddSpuDate(V.c3Id)},v=i=>{f.value=1,P.value.initEditSpuData(i)},A=i=>{f.value=i.flag,i.params=="update"?D(k.value):D()},m=i=>{f.value=2,N.value.initAddSkuDate(V.c1Id,V.c2Id,i)},I=async i=>{let p=await ve(i.id);p.code==200?(d.value=p.data,b.value=!0):h({type:"error",message:"未查询到sku产品数据"})},U=async i=>{(await ke(i)).code==200?(h({type:"success",message:"删除SPU成功"}),D(z.value.length>1?k.value:k.value-1)):h({type:"error",message:"删除SPU失败"})};return ge(()=>{V.$reset()}),(i,p)=>{const E=o("Category"),$=o("el-button"),l=o("el-table-column"),n=o("el-table"),u=o("el-pagination"),C=o("el-dialog"),K=o("el-card");return S(),q(B,null,[e(E,{scene:t(f)},null,8,["scene"]),e(K,{class:"box-card"},{default:a(()=>[W(G("div",null,[e($,{type:"primary",size:"default",icon:"Plus",disabled:!t(V).c3Id,onClick:t(x)},{default:a(()=>[F("添加SPU")]),_:1},8,["disabled","onClick"]),e(n,{border:"",style:{margin:"10px 0"},data:t(z)},{default:a(()=>[e(l,{label:"序号",type:"index",align:"center",width:"80px"}),e(l,{label:"SPU名称",prop:"spuName"}),e(l,{label:"SPU描述",prop:"description"}),e(l,{label:"SPU操作"},{default:a(({row:r,$index:H})=>[e($,{type:"primary",size:"small",icon:"Plus",title:"添加一个SKU",onClick:M=>t(m)(r)},null,8,["onClick"]),e($,{type:"primary",size:"small",icon:"Edit",title:"修改某个SPU",onClick:M=>t(v)(r)},null,8,["onClick"]),e($,{type:"primary",size:"small",icon:"View",title:"查看SKU",onClick:M=>t(I)(r)},null,8,["onClick"]),e($,{type:"primary",size:"small",icon:"Delete",title:"删除Spu",onClick:M=>t(U)(r.id)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(u,{"current-page":t(k),"onUpdate:currentPage":p[0]||(p[0]=r=>j(k)?k.value=r:k=r),"page-size":t(y),"onUpdate:pageSize":p[1]||(p[1]=r=>j(y)?y.value=r:y=r),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:t(g),onCurrentChange:t(D),onSizeChange:p[2]||(p[2]=r=>t(D)())},null,8,["current-page","page-size","total","onCurrentChange"])],512),[[X,t(f)==0]]),W(e(be,{onChangeScene:t(A),ref_key:"spuForm",ref:P},null,8,["onChangeScene"]),[[X,t(f)==1]]),W(e(Ae,{onChangeScene:t(A),ref_key:"skuForm",ref:N},null,8,["onChangeScene"]),[[X,t(f)==2]]),e(C,{title:"SKU列表",modelValue:t(b),"onUpdate:modelValue":p[3]||(p[3]=r=>j(b)?b.value=r:b=r)},{default:a(()=>[e(n,{data:t(d)},{default:a(()=>[e(l,{label:"sku名字",prop:"skuName"}),e(l,{label:"sku价格",prop:"price"}),e(l,{label:"sku重量",prop:"weight"}),e(l,{label:"sku图片"},{default:a(({row:r,$index:H})=>[G("img",{src:r.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ie)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{he as default};
