import{I as V,d as ce,k as d,J as pe,A as fe,r as c,K as ve,o as R,c as P,h as e,w as t,u as o,x as y,y as i,q as ge,g as E,a as S,t as F,j as _e,F as H,f as ye,n as M,L as k}from"./index-511768d2.js";import{u as be}from"./setting-671950c7.js";const we=(u,q,m)=>V.get(`/admin/acl/user/${u}/${q}/?username=${m}`),Ce=u=>u.id?V.put("/admin/acl/user/update",u):(console.log(123),V.post("/admin/acl/user/save",u)),he=u=>V.get("/admin/acl/user/toAssign/"+u),Ve=u=>V.post("/admin/acl/user/doAssignRole",u),ke=u=>V.delete("/admin/acl/user/remove/"+u),xe=u=>V.delete("/admin/acl/user/batchRemove",{data:u}),Ue={style:{flex:"auto"}},ze=S("h4",null,"分配角色(职位)",-1),Re={style:{flex:"auto"}},Ee=ce({__name:"index",setup(u){let q=be(),m=d(1),x=d(5),A=d([]),j=d(0),g=d(!1),s=d({username:"",name:"",password:""}),_=d(),$=pe(()=>s.value.id?"更新用户":"添加用户"),U=d([]),b=d([]),N=d([]),w=d("");fe(()=>{C()});let C=async(n=1)=>{m.value=n;let l=await we(m.value,x.value,w.value);l.code==200&&(A.value=l.data.records,j.value=l.data.total)},J=()=>{C()},K=()=>{g.value=!0,Object.assign(s.value,{username:"",name:"",password:"",id:0}),M(()=>{_.value.clearValidate("name"),_.value.clearValidate("username"),_.value.clearValidate("password")})},G=()=>{g.value=!1},Q=async()=>{await _.value.validate(),g.value=!1,(await Ce(s.value)).code==200?(k({type:"success",message:s.value.id?"更新用户成功":"添加用户成功"}),window.location.reload()):k({type:"error",message:s.value.id?"更新用户失败":"添加用户失败"})},W=n=>{Object.assign(s.value,n),g.value=!0,M(()=>{_.value.clearValidate("name"),_.value.clearValidate("username"),_.value.clearValidate("password")})};const X={username:[{required:!0,trigger:"blur",validator:(n,l,r)=>{l.length>=5?r():r(new Error("用户姓名长度应该大于5位"))}}],name:[{required:!0,trigger:"blur",validator:(n,l,r)=>{l.length>=5?r():r(new Error("用户昵称长度应该大于5位"))}}],password:[{required:!0,trigger:"blur",validator:(n,l,r)=>{l.length>=6?r():r(new Error("用户密码应该大于等于6位"))}}]};let f=d(!1);const Y=async n=>{Object.assign(s.value,n);let l=await he(n.id);l.code==200&&(U.value=l.data.allRolesList,b.value=l.data.assignRoles,f.value=!0)};let z=d(!1),L=d(!0);const Z=n=>{b.value=n?U.value:[],L.value=!1},ee=n=>{z.value=n.length===U.value.length,L.value=n.length!==U.value.length},le=async()=>{let n={roleIdList:b.value.map(r=>r.id),userId:s.value.id};(await Ve(n)).code==200&&(k({type:"success",message:"修改职位成功"}),f.value=!1,C())},ae=async n=>{(await ke(n.id)).code==200&&(k({type:"success",message:"删除用户成功"}),C(A.value.length>1?m.value:m.value-1))},te=async n=>{let l=n.map(r=>r.id);N.value=l},oe=async()=>{(await xe(N.value)).code==200?(k({type:"success",message:"删除用户成功"}),C(A.value.length>1?m.value:m.value-1)):k({type:"error",message:"删除失败"})},ne=()=>{C(),w.value=""},re=()=>{q.refresh=!q.refresh};return(n,l)=>{const r=c("el-input"),h=c("el-form-item"),p=c("el-button"),D=c("el-form"),I=c("el-card"),v=c("el-table-column"),se=c("el-popconfirm"),ue=c("el-table"),de=c("el-pagination"),T=c("el-drawer"),B=c("el-checkbox"),ie=c("el-checkbox-group"),me=ve("has");return R(),P(H,null,[e(I,{class:"box-card"},{default:t(()=>[e(D,{inline:!0,class:"user"},{default:t(()=>[e(h,{label:"用户名:"},{default:t(()=>[e(r,{placeholder:"请输入用户名",modelValue:o(w),"onUpdate:modelValue":l[0]||(l[0]=a=>y(w)?w.value=a:w=a)},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(p,{type:"primary",size:"default",disabled:!o(w),onClick:ne},{default:t(()=>[i("搜索")]),_:1},8,["disabled"]),e(p,{size:"default",onClick:re},{default:t(()=>[i("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(I,{style:{margin:"10px 0px"}},{default:t(()=>[ge((R(),E(p,{type:"primary",size:"default",onClick:o(K)},{default:t(()=>[i("添加用户")]),_:1},8,["onClick"])),[[me,"btn.Trademark.add"]]),e(p,{type:"danger",size:"default",onClick:oe,disabled:!o(N).length},{default:t(()=>[i("批量删除")]),_:1},8,["disabled"]),e(ue,{border:"",style:{margin:"10px 0"},data:o(A),onSelectionChange:te},{default:t(()=>[e(v,{type:"selection",align:"center"}),e(v,{label:"#",align:"center",type:"index"}),e(v,{label:"ID",align:"center",prop:"id"}),e(v,{label:"用户名字",align:"center",prop:"name","show-overflow-tooltip":""}),e(v,{label:"用户名称",align:"center",prop:"username","show-overflow-tooltip":""}),e(v,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(v,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:Ne})=>[e(p,{size:"small",icon:"User",onClick:O=>Y(a)},{default:t(()=>[i("分配角色")]),_:2},1032,["onClick"]),e(p,{type:"primary",size:"small",icon:"Edit",onClick:O=>o(W)(a)},{default:t(()=>[i("编辑")]),_:2},1032,["onClick"]),e(se,{title:`你确定要删除${a.username}吗?`,onConfirm:O=>ae(a),width:"250"},{reference:t(()=>[e(p,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[i("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(de,{"current-page":o(m),"onUpdate:currentPage":l[1]||(l[1]=a=>y(m)?m.value=a:m=a),"page-size":o(x),"onUpdate:pageSize":l[2]||(l[2]=a=>y(x)?x.value=a:x=a),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:o(j),onSizeChange:o(J),onCurrentChange:o(C)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),e(T,{modelValue:o(g),"onUpdate:modelValue":l[6]||(l[6]=a=>y(g)?g.value=a:g=a),direction:"rtl"},{header:t(()=>[S("h4",null,F(o($)),1)]),default:t(()=>[e(D,{model:o(s),rules:X,ref_key:"formRef",ref:_},{default:t(()=>[e(h,{label:"用户姓名",prop:"username"},{default:t(()=>[e(r,{placeholder:"请填写用户姓名",modelValue:o(s).username,"onUpdate:modelValue":l[3]||(l[3]=a=>o(s).username=a)},null,8,["modelValue"])]),_:1}),e(h,{label:"用户昵称",prop:"name"},{default:t(()=>[e(r,{placeholder:"请填写用户昵称",modelValue:o(s).name,"onUpdate:modelValue":l[4]||(l[4]=a=>o(s).name=a)},null,8,["modelValue"])]),_:1}),o(s).id?_e("",!0):(R(),E(h,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(r,{placeholder:"请填写用户密码",modelValue:o(s).password,"onUpdate:modelValue":l[5]||(l[5]=a=>o(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[S("div",Ue,[e(p,{onClick:o(G)},{default:t(()=>[i("取消")]),_:1},8,["onClick"]),e(p,{type:"primary",onClick:o(Q)},{default:t(()=>[i("确认")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),e(T,{modelValue:o(f),"onUpdate:modelValue":l[10]||(l[10]=a=>y(f)?f.value=a:f=a),direction:"rtl"},{header:t(()=>[ze]),default:t(()=>[e(D,null,{default:t(()=>[e(h,{label:"用户姓名"},{default:t(()=>[e(r,{value:o(s).username,disabled:!0},null,8,["value"])]),_:1}),e(h,{label:"职位列表"},{default:t(()=>[e(B,{modelValue:o(z),"onUpdate:modelValue":l[7]||(l[7]=a=>y(z)?z.value=a:z=a),indeterminate:o(L),onChange:Z},{default:t(()=>[i("全选")]),_:1},8,["modelValue","indeterminate"]),e(ie,{modelValue:o(b),"onUpdate:modelValue":l[8]||(l[8]=a=>y(b)?b.value=a:b=a),onChange:ee},{default:t(()=>[(R(!0),P(H,null,ye(o(U),a=>(R(),E(B,{key:a,label:a},{default:t(()=>[i(F(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[S("div",Re,[e(p,{onClick:l[9]||(l[9]=a=>y(f)?f.value=!1:f=!1)},{default:t(()=>[i("取消")]),_:1}),e(p,{type:"primary",onClick:le},{default:t(()=>[i("确定")]),_:1})])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ee as default};
